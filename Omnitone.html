<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omnitone</title>
    <script src="https://www.gstatic.com/external_hosted/omnitone/build/omnitone.min.js"></script>
    <script src = Javascript/Omnitone.js type = text/javascript></script>
    <script src="https://storage.googleapis.com/vrview/2.0/build/vrview.min.js"></script>
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
    <script src="Javascript/CompileRSB.js" type="text/javascript"></script>
    <script src="Javascript/CompileCSA.js" type="text/javascript"></script>
    <script src="Javascript/SettingsMenu.js" type="text/javascript"></script>

    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <link rel="stylesheet" href="Style/RSBButtons.css">
    <link rel="stylesheet" href="Style/CSAButtons.css">
    <link rel="stylesheet" href="Style/Layout.css">
    <link rel="stylesheet" href="Style/Root.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>

<body id = blurbody onload = "loadSource('Source Files/Clarinet.wav')">

    <header id = appbar class="mdc-top-app-bar">
        <div class="mdc-top-app-bar__row">
            <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
                <button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button"
                        style="color: var(--text-color)"
                        onclick=toggleDrawer()>menu</button>
              <span class="mdc-top-app-bar__title">Omnitone</span>
            </section>
            <section class = "mdc-top-app-bar__section mdc-top-app-bar__section--align-end">
                <input type = "button" id = "play" onclick = "compile(); play();" value = "Play">
            </section>
            <section class = "mdc-top-app-bar__section">
                <div id = error>error: no such source-receiver combination</div>
            </section>
        </div>
    </header>

    <div id = drawer>
        <div id = roomselect>
            <input class = 'roombuttonselected' id = rsb type = button value = RSB onclick="switchRoom()">
            <input class = 'roombutton' id = csa type = button value = CSA onclick="switchRoom()">
        </div>

        <div id = formatselect>
            <input class = 'roombuttonselected' id = aformat type = button value = A onclick = "switchFormat()">
            <input class = 'roombutton' id = bformat type = button value = B onclick = "switchFormat()">
        </div>

        <label id = olabel for = 'output'>Output</label>
        <input type = "range" id = "output" min = 0 max = 30 value = 30 oninput = setGain(this.value)>
    </div>

    <div id = view></div>
    <div id = RSBui>
        <input type = button id = spS1_RSB class = yellowsquare value = "S1" onclick = updateSrcpos("spS1_RSB")>
        <input type = button id = spS3_RSB class = yellowsquare value = "S3" onclick = updateSrcpos("spS3_RSB")>
        <input type = button id = spS5_RSB class = yellowsquare value = "S5" onclick = updateSrcpos("spS5_RSB")>
        <input type = button id = spS7_RSB class = yellowsquare value = "S7" onclick = updateSrcpos("spS7_RSB")>


        <input type = button id = st1_RSB class = barbutton value = "NTID" onclick = updateSrctype("st1_RSB")>
        <input type = button id = st2_RSB class = barbutton value = "YMH" onclick = updateSrctype("st2_RSB")>


        <input type = button id = rpR1_RSB class = bluebutton value = "R1" onclick = updateRcvpos("rpR1_RSB")>
        <input type = button id = rpR2_RSB class = bluebutton value = "R2" onclick = updateRcvpos("rpR2_RSB")>
        <input type = button id = rpR3_RSB class = bluebutton value = "R3" onclick = updateRcvpos("rpR3_RSB")>
        <input type = button id = rpR4_RSB class = bluebutton value = "R4" onclick = updateRcvpos("rpR4_RSB")>
    </div>
    <div id = CSAui style = "display: none">
        <input type = button id = mt1_CSA class = barbutton value = ZMH3V>
        <input type = button id = mt2_CSA class = barbutton value = RODE>

        <input type = button id = st1_CSA class = barbutton value = "NTID" onclick = updateSrctype("st1_CSA")>
        <input type = button id = st2_CSA class = barbutton value = "J308" onclick = updateSrctype("st2_CSA")>

        <input type = button id = spS1_CSA class = yellowsquare value = "S1" onclick = updateSrcpos("spS1_CSA")>
        <input type = button id = spS2_CSA class = yellowsquare value = "S2" onclick = updateSrcpos("spS2_CSA")>
        <input type = button id = spS3_CSA class = yellowsquare value = "S3" onclick = updateSrcpos("spS3_CSA")>
        <input type = button id = spS4_CSA class = yellowsquare value = "S4" onclick = updateSrcpos("spS4_CSA")>

        <input type = button id = rpR1_CSA class = bluebutton value = "R1" onclick = updateRcvpos("rpR1_CSA")>
        <input type = button id = rpR2_CSA class = bluebutton value = "R2" onclick = updateRcvpos("rpR2_CSA")>
        <input type = button id = rpR3_CSA class = bluebutton value = "R3" onclick = updateRcvpos("rpR3_CSA")>
        <input type = button id = rpR4_CSA class = bluebutton value = "R4" onclick = updateRcvpos("rpR4_CSA")>
        <input type = button id = rpR5_CSA class = bluebutton value = "R5" onclick = updateRcvpos("rpR5_CSA")>
        <input type = button id = rpR6_CSA class = bluebutton value = "R6" onclick = updateRcvpos("rpR6_CSA")>
    </div>
</body>
<script>

    let room = "CSA";
    let format = "A";
    let reverb;
    let viewer;
    let mictype;
    let srcpos;
    let srctype;
    let rcvpos;

    setImage("Images/wp1909404.jpg");
    switchRoom(); //sets default values

    function setAngle()
    {
        setPos(viewer.getYaw() + 180, viewer.getPitch() + 180); //values are from -180 to 180, that's why we add 180
    }
    function runner()
    {
        setAngle();
        setTimeout(function () {
            runner();
        }, 0);
    }

    function setImage(image)
    {
        viewer = pannellum.viewer('view', {
            "type": "equirectangular",
            "panorama": image,
            "autoLoad": true
        });
        runner();
    }

    function updateSrcpos(val)
    {
        document.getElementById(srcpos).style.backgroundColor = "var(--buttoncolor2)";
        srcpos = val;
        compile()
    }
    function updateSrctype(val)
    {
        document.getElementById(srctype).style.backgroundColor = "var(--buttoncolor3)";
        srctype = val;
        compile();
    }
    function updateRcvpos(val)
    {
        document.getElementById(rcvpos).style.backgroundColor = "var(--buttoncolor1)";
        rcvpos = val;
        compile();
    }
    function updateMicType(val)
    {
        document.getElementById(mictype).style.backgroundColor = "var(--buttoncolor3)";
        mictype = val;
        compileSelectionCSA();
    }

    function updateSelectedColor(urlexists)
    {
        if(urlexists)
        {
            document.getElementById(srcpos).style.backgroundColor = "var(--highlightcolor1)";
            document.getElementById(srctype).style.backgroundColor = "var(--highlightcolor1)";
            document.getElementById(rcvpos).style.backgroundColor = "var(--highlightcolor1)";
        }
        else
        {
            document.getElementById(srcpos).style.backgroundColor = "var(--warning)";
            document.getElementById(srctype).style.backgroundColor = "var(--warning)";
            document.getElementById(rcvpos).style.backgroundColor = "var(--warning)";
        }
    }

    function toggleDrawer()
    {
        if(document.getElementById('drawer').style.display === "none")
        {
            document.getElementById('drawer').style.display = "flex";
        }
        else
        {
            document.getElementById('drawer').style.display = "none";
        }
    }

    function compile()
    {
        if(room === "RSB")
        {
            compileSelectionRSB();
        }
        else if(room === "CSA")
        {
            compileSelectionCSA();
        }
    }
</script>
</html>
